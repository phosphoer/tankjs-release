!function(){"use strict";TANK.registerComponent("Collider2D").includes("Pos2D").construct(function(){this.width=1,this.height=1,this.collisionLayer="",this.collidesWith=[],this.testCollision=function(t){return 1===this.width||1===this.height?TANK.Math2D.pointInOBB(this.entity.Pos2D.pos,t.entity.Pos2D.pos,[t.width,t.height],t.entity.Pos2D.rotation):1===t.width||1===t.height?TANK.Math2D.pointInOBB(t.entity.Pos2D.pos,this.entity.Pos2D.pos,[this.width,this.height],this.entity.Pos2D.rotation):TANK.Math2D.AABBInAABB(this.entity.Pos2D.pos,[this.width,this.height],t.entity.Pos2D.pos,[t.width,t.height])}}).serialize(function(t){t.property(this,"width",0),t.property(this,"height",0),t.property(this,"collisionLayer",""),t.property(this,"collidesWith",[])}).initialize(function(){var t=this._entity.getFirstParentWithComponent("CollisionManager");t||console.error("The Collider2D component couldn't find a CollisionManager to register with"),t.CollisionManager.add(this)})}(),function(){"use strict";TANK.registerComponent("CollisionManager").construct(function(){this._colliders=[]}).initialize(function(){this.add=function(t){t.collidesWith||(t.collidesWith=[]),t.width?t.height?"function"!=typeof t.testCollision?console.error("A component was added to CollisionManager with no testCollision function"):!t.collisionLayer&&t.collidesWith.length>0?console.error("A component was added to CollisionManager with collidesWith but no collisionLayer"):!t.collidesWith.length&&t.collisionLayer&&console.error("A component was added to CollisionManager with collisionLayer but no collidesWith"):console.error("A component was added to CollisionManager with no height"):console.error("A component was added to CollisionManager with no width"),t.collisionLayer||(t.collisionLayer="default",t.collidesWith=["default"]),this._colliders.push(t)},this.remove=function(t){var e=this._colliders.indexOf(t);this._colliders.splice(e,1)},this.update=function(){this._colliders=this._colliders.filter(function(t){return t._initialized});for(var t=0;t<this._colliders.length;++t)this._checkCollisionOnComponent(t)},this._checkCollisionOnComponent=function(t){for(var e=t+1;e<this._colliders.length;++e)this._testCollision(this._colliders[t],this._colliders[e])},this._testCollision=function(t,e){var i;if(t.collidesWith.indexOf(e.collisionLayer)>=0)i=t.testCollision(e),i&&(t._entity.dispatch("collide",e._entity,i),e._entity.dispatch("collide",t._entity,i));else if(e.collidesWith.indexOf(t.collisionLayer)>=0){var i=e.testCollision(t);i&&(t._entity.dispatch("collide",e._entity,i),e._entity.dispatch("collide",t._entity,i))}}})}(),TANK.registerComponent("GLRenderer2D").construct(function(){this.canvas=null,this._drawables=[],this._defaultVSSource=["attribute vec3 vertexPos;","uniform mat3 view;","uniform mat3 transform;","void main(void)","{","  vec3 transformed = vertexPos * transform * view;","  gl_Position = vec4(transformed, 1.0);","}"].join("\n"),this._defaultFSSource=["void main(void)","{","  gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","}"].join("\n")}).initialize(function(){var t;this.add=function(t){this._drawables.push(t)},this.remove=function(t){this._drawables.splice(this._drawables.indexOf(t),1)},this._createContext=function(){this._context=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),t=this._context,t.viewport(0,0,this.canvas.width,this.canvas.height),t.clearColor(0,0,0,1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this._defaultVS=t.createShader(t.VERTEX_SHADER),this._defaultFS=t.createShader(t.FRAGMENT_SHADER),t.shaderSource(this._defaultVS,this._defaultVSSource),t.shaderSource(this._defaultFS,this._defaultFSSource),t.compileShader(this._defaultVS),t.compileShader(this._defaultFS),t.getShaderParameter(this._defaultVS,t.COMPILE_STATUS)||console.error(t.getShaderInfoLog(this._defaultVS)),t.getShaderParameter(this._defaultFS,t.COMPILE_STATUS)||console.error(t.getShaderInfoLog(this._defaultFS)),this._defaultProgram=t.createProgram(),t.attachShader(this._defaultProgram,this._defaultVS),t.attachShader(this._defaultProgram,this._defaultFS),t.linkProgram(this._defaultProgram),t.useProgram(this._defaultProgram),this._quadVertexAttribute=t.getAttribLocation(this._defaultProgram,"vertexPos"),t.enableVertexAttribArray(this._quadVertexAttribute);var e=[25,25,1,-25,25,1,25,-25,1,-25,-25,1];this._quadVBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._quadVBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)},this.update=function(){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.bindBuffer(t.ARRAY_BUFFER,this._quadVBuffer),t.vertexAttribPointer(this._quadVertexAttribute,3,t.FLOAT,!1,0,0);var e=[2/this.canvas.width,0,0,0,2/this.canvas.height,0,0,0,1];t.uniformMatrix3fv(t.getUniformLocation(this._defaultProgram,"view"),!1,new Float32Array(e));for(var i=0;i<this._drawables.length;++i){var s=this._drawables[i],n=s._entity.Pos2D,o=[Math.cos(n.rotation),-Math.sin(n.rotation),n.x,Math.sin(n.rotation),Math.cos(n.rotation),n.y,0,0,1];t.uniformMatrix3fv(t.getUniformLocation(this._defaultProgram,"transform"),!1,new Float32Array(o)),t.drawArrays(t.TRIANGLE_STRIP,0,4)}},this._createContext()}),TANK.registerComponent("GLSprite").includes("Pos2D").construct(function(){this.zdepth=0,this.imagePath="",this._glTexture=null}).initialize(function(){TANK.main.GLRenderer2D.add(this),this.update=function(t){this._entity.Pos2D.x+=10*t,this._entity.Pos2D.rotation+=.5*t}}).uninitialize(function(){TANK.main.GLRenderer2D.remove(this)}),function(){"use strict";TANK.registerComponent("Image").includes("Pos2D").construct(function(){this.zdepth=0,this.image=new Image,this.scale=1,this.pivotPoint=[0,0]}).initialize(function(){var t=this._entity.Pos2D,e=this._entity.getFirstParentWithComponent("Renderer2D");e||console.error("The Image component couldn't find a Renderer2D to register with"),e.Renderer2D.add(this),this.draw=function(e,i){this.image&&(e.save(),e.translate(t.x-i.x,t.y-i.y),e.rotate(t.rotation),e.scale(this.scale,this.scale),e.translate(this.image.width/-2+this.pivotPoint[0],this.image.height/-2+this.pivotPoint[1]),e.drawImage(this.image,0,0),e.restore())}})}(),function(){"use strict";TANK.registerComponent("Input").construct(function(){this.context=null,this.mousePos=[0,0],this.lastMousePos=[0,0],this.mouseDelta=[0,0],this._keysHeld=[],this._events=["keydown","keyup","mousemove","mousedown","mouseup","touchmove","touchstart","touchend","mousewheel","contextmenu","gestureend","gesturechange"],this._noContextEvents={keydown:!0,keyup:!0}}).initialize(function(){var t=this.context||window,e=this,i=function(t){t.preventDefault();var i=!0;"mousemove"===t.type&&(e.lastMousePos[0]=e.mousePos[0],e.lastMousePos[1]=e.mousePos[1],e.mousePos[0]=t.x-(e.context?e.context.offsetLeft:0),e.mousePos[1]=t.y-(e.context?e.context.offsetTop:0),e.mouseDelta=TANK.Math2D.subtract(e.mousePos,e.lastMousePos)),"keydown"===t.type&&(e._keysHeld[t.keyCode]?i=!1:e._keysHeld[t.keyCode]=!0),"keyup"===t.type&&(e._keysHeld[t.keyCode]?e._keysHeld[t.keyCode]=!1:i=!1),"mousedown"===t.type?e._keysHeld[t.button]=!0:"mouseup"===t.type&&(e._keysHeld[t.button]=!1),i&&e._entity.dispatchNextFrame(t.type,t)};this.addListeners=function(){for(var e=0;e<this._events.length;++e)this._noContextEvents[this._events[e]]?window.addEventListener(this._events[e],i):t.addEventListener(this._events[e],i)},this.removeListeners=function(){for(var e=0;e<this._events.length;++e)this._noContextEvents[this._events[e]]?window.removeEventListener(this._events[e],i):t.removeEventListener(this._events[e],i)},this.isDown=function(t){return this._keysHeld[t]},this.addListeners()}).uninitialize(function(){this.removeListeners()})}(),function(){"use strict";var t=function(){this.x=0,this.y=0,this.r=0,this.vx=0,this.vy=0,this.vr=0,this.life=0,this.alpha=1,this.scale=1,this.friction=1,this.alphaDecay=1,this.scaleDecay=1};TANK.registerComponent("ParticleEmitter").includes("Pos2D").construct(function(){this.zdepth=1,this.particleImage=new Image,this.blendMode="lighter",this.spawning=!0,this.spawnOffsetMin=[0,0],this.spawnOffsetMax=[0,0],this.spawnSpeedMin=10,this.spawnSpeedMax=15,this.spawnAngleMin=0,this.spawnAngleMax=2*Math.PI,this.spawnRotationMin=0,this.spawnRotationMax=2*Math.PI,this.spawnAlphaMin=1,this.spawnAlphaMax=1,this.spawnScaleMin=1,this.spawnScaleMax=1.3,this.spawnPerSecond=10,this.spawnDuration=0,this.particleLifeMin=1,this.particleLifeMax=3,this.particleFrictionMin=.9,this.particleFrictionMax=.95,this.particleAlphaDecayMin=.9,this.particleAlphaDecayMax=.95,this.particleRotateSpeedMin=0,this.particleRotateSpeedMax=1,this.particleScaleDecayMin=.95,this.particleScaleDecayMax=.98,this.alignRotationToSpawnAngle=!1,this.globalForce=[0,0],this.particleUpdateFunc=null,this.particleDrawFunc=null,this.particles=[],this.deleted=[],this.spawnTimer=0,this.spawnAccum=0}).initialize(function(){var e=this._entity.Pos2D;return this._entity._parent?this._entity._parent.Renderer2D?(this._entity._parent.Renderer2D.add(this),this.update=function(i){if(this.spawnTimer+=i,this.spawnTimer>this.spawnDuration&&this.spawnDuration>0&&(this.spawning=!1),this.spawning&&(this.spawnAccum+=this.spawnPerSecond*i,this.spawnAccum>=1)){for(var s=Math.floor(this.spawnAccum),n=0;s>n;++n){var o=new t,a=this.spawnAngleMin+Math.random()*(this.spawnAngleMax-this.spawnAngleMin),r=this.spawnSpeedMin+Math.random()*(this.spawnSpeedMax-this.spawnSpeedMin);o.vx=Math.cos(a)*r,o.vy=Math.sin(a)*r,o.life=this.particleLifeMin+Math.random()*(this.particleLifeMax-this.particleLifeMin),o.x=e.x+this.spawnOffsetMin[0]+Math.random()*(this.spawnOffsetMax[0]-this.spawnOffsetMin[0]),o.y=e.y+this.spawnOffsetMin[1]+Math.random()*(this.spawnOffsetMax[1]-this.spawnOffsetMin[1]),o.r=this.spawnRotationMin+Math.random()*(this.spawnRotationMax-this.spawnRotationMin),o.vr=this.particleRotateSpeedMin+Math.random()*(this.particleRotateSpeedMax-this.particleRotateSpeedMin),o.alpha=this.spawnAlphaMin+Math.random()*(this.spawnAlphaMax-this.spawnAlphaMin),o.scale=this.spawnScaleMin+Math.random()*(this.spawnScaleMax-this.spawnScaleMin),o.friction=this.particleFrictionMin+Math.random()*(this.particleFrictionMax-this.particleFrictionMin),o.alphaDecay=this.particleAlphaDecayMin+Math.random()*(this.particleAlphaDecayMax-this.particleAlphaDecayMin),o.scaleDecay=this.particleScaleDecayMin+Math.random()*(this.particleScaleDecayMax-this.particleScaleDecayMin),this.alignRotationToSpawnAngle&&(o.r=a),this.particles.push(o)}this.spawnAccum-=s}for(var n=0;n<this.particles.length;++n){var o=this.particles[n];o.life-=i,o.x+=o.vx*i,o.y+=o.vy*i,o.r+=o.vr*i,o.vx*=o.friction,o.vy*=o.friction,o.vx+=this.globalForce[0]*i,o.vy+=this.globalForce[1]*i,o.alpha*=o.alphaDecay,o.scale*=o.scaleDecay,this.particleUpdateFunc&&this.particleUpdateFunc(o,i),o.life<0&&this.deleted.push(n)}for(var n=0;n<this.deleted.length;++n)this.particles.splice(this.deleted[n],1);this.deleted=[]},void(this.draw=function(t,e,i){for(var s=0;s<this.particles.length;++s){t.save(),t.globalCompositeOperation=this.blendMode;var n=this.particles[s];t.translate(n.x-e.x,n.y-e.y),t.scale(n.scale,n.scale),t.rotate(n.r),this.particleImage.width&&t.translate(-this.particleImage.width/2,-this.particleImage.height/2),t.globalAlpha=n.alpha,this.particleDrawFunc?this.particleDrawFunc(n,t,e,i):t.drawImage(this.particleImage,0,0),t.restore()}})):void console.error("The ParticleEmitter couldn't find a Renderer2D to register with"):void console.error("The Entity the ParticleEmitter was added to has no parent")})}(),function(){"use strict";TANK.registerComponent("Pos2D").construct(function(){this.pos=[0,0],this.rotation=0,Object.defineProperty(this,"x",{get:function(){return this.pos[0]},set:function(t){this.pos[0]=t}}),Object.defineProperty(this,"y",{get:function(){return this.pos[1]},set:function(t){this.pos[1]=t}})}).serialize(function(t){t.property(this,"pos",[0,0]),t.property(this,"rotation",0)})}(),function(){"use strict";TANK.registerComponent("Renderer2D").construct(function(){this.context=null,this.camera={x:0,y:0,z:1},this.clearColor="#000",this.nearestNeighbor=!0,this._drawables={},this._drawablesSorted=[]}).initialize(function(){this.add=function(t){void 0===t.zdepth&&(console.error("A component was added to Renderer2D with an undefined zdepth"),t.zdepth=0),this._drawables[t._name+t._entity._id]=t,this._sort()},this.remove=function(t){delete this._drawables[t._name+t._entity._id],this._sort()},this._sort=function(){this._drawablesSorted=[];for(var t in this._drawables)this._drawablesSorted.push(this._drawables[t]);this._drawablesSorted.sort(function(t,e){return t.zdepth-e.zdepth})},this.update=function(t){if(this.context){this.nearestNeighbor&&(this.context.imageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.mozImageSmoothingEnabled=!1),this.context.save(),this.context.fillStyle=this.clearColor,this.context.fillRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.restore(),this.context.save(),this.context.translate(this.context.canvas.width/2,this.context.canvas.height/2),this.context.scale(1/this.camera.z,1/this.camera.z);for(var e,i=!1,s=0;s<this._drawablesSorted.length;++s)e=this._drawablesSorted[s],e._initialized?this._drawablesSorted[s].draw(this.context,this.camera,t):(delete this._drawables[e._name+e._entity._id],i=!0);this.context.restore(),i&&this._sort()}}})}(),function(){"use strict";TANK.registerComponent("Resources").construct(function(){this._resourcesToLoad={},this._resourcesLoaded=0,this._resources={},this._queuedResources=[]}).initialize(function(){this.add=function(t,e,i,s){this._resourcesToLoad[t]={name:t,path:e,dependencies:i||[],loader:s}},this.get=function(t){return this._resources[t]},this.getAll=function(){return this._resources},this.load=function(){for(var t in this._resourcesToLoad)this._loadResource(this._resourcesToLoad[t],!0)},this._resourceLoaded=function(t,e){this._resources[t.name]=e,++this._resourcesLoaded,t.loaded=!0;var i=Object.keys(this._resourcesToLoad).length;if(this._resourcesLoaded>=i)return void this._entity.dispatch("resourcesloaded");for(var s=0;s<this._queuedResources.length;++s)this._loadResource(this._queuedResources[s],!1)},this._loadResource=function(t,e){if(!t.loaded){for(var i=!0,s=0;s<t.dependencies.length;++s){var n=this._resourcesToLoad[t.dependencies[s]];n.loaded||(i=!1)}if(!i)return void(e&&this._queuedResources.push(t));if(t.loader)t.loader(t.name,t.path,this,function(e){this._resourceLoaded(t,e)}.bind(this));else if(t.path&&t.path.search(/(.png|.jpg|.jpeg|.gif)/)>=0){var o=new Image;o.src=t.path,o.onload=function(){this._resourceLoaded(t,o)}.bind(this)}}}})}(),function(){"use strict";TANK.registerComponent("Velocity").includes("Pos2D").construct(function(){this.x=0,this.y=0,this.r=0}).serialize(function(t){t.property(this,"x",0),t.property(this,"y",0),t.property(this,"r",0)}).initialize(function(){this.getSpeed=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.update=function(t){var e=this._entity.Pos2D;e.x+=this.x*t,e.y+=this.y*t,e.rotation+=this.r*t}})}();