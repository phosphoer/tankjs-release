!function(t){t.Action=t.Action||{},t.Action.State={uninitialized:0,queued:1,active:2,complete:3,cancelled:4},t.Action.mixin=function(e){return e._state=t.Action.State.uninitialized,e.cancel||(e.cancel=function(){this._state=t.Action.State.cancelled}),e.done||(e.done=function(){this._state=t.Action.State.complete}),e},t.Action.Group=function(){this._actions=[]},t.Action.Group.prototype.add=function(e){t.Action.mixin(e),this._actions.push(e),e._state=t.Action.State.queued,(this._state===t.Action.State.complete||this._state===t.Action.State.cancelled)&&(this._state=t.Action.State.active)},t.Action.Group.prototype.update=function(e,i){for(var n,o=!0,s=0;s<this._actions.length;++s)n=this._actions[s],n._state===t.Action.State.queued&&(n.start&&n.start(e),n._state=t.Action.State.active),n._state===t.Action.State.active&&(n.update&&n.update(e,i),n._state!==t.Action.State.active?n.end&&n.end(e):o=!1);this._actions=this._actions.filter(function(e){return e._state===t.Action.State.queued||e._state===t.Action.State.active}),o&&(this._state=t.Action.State.complete)},t.Action.Group.prototype.cancel=function(){for(var e=0;e<this._actions.length;++e)this._actions[e].cancel();this._state=t.Action.State.cancelled},t.Action.Sequence=function(){this._actions=[]},t.Action.Sequence.prototype.add=function(e){t.Action.mixin(e),this._actions.push(e),e._state=t.Action.State.queued,(this._state===t.Action.State.complete||this._state===t.Action.State.cancelled)&&(this._state=t.Action.State.active)},t.Action.Sequence.prototype.update=function(e,i){var n=this._actions[0];n&&(n._state===t.Action.State.queued&&(n.start&&n.start(e),n._state=t.Action.State.active),n._state===t.Action.State.active&&(n.update&&n.update(e,i),n._state!==t.Action.State.active&&n.end&&n.end(e)),(n._state===t.Action.State.complete||n._state===t.Action.State.cancelled)&&this._actions.splice(0,1)),this._actions.length||(this._state=t.Action.State.complete)},t.Action.Sequence.prototype.cancel=function(){for(var e=0;e<this._actions.length;++e)this._actions[e].cancel();this._state=t.Action.State.cancelled}}("undefined"==typeof exports?this.TANK=this.TANK||{}:exports),function(t){"use strict";t.Component=function(t){this._name=t._name,this._construct=t._construct,this._serialize=t._serialize,this._initialize=t._initialize,this._uninitialize=t._uninitialize,this._entity=null,this._constructed=!1,this._initialized=!1,this._listeners=[],this._construct(),this._constructed=!0,Object.defineProperty(this,"name",{get:function(){return this._name}}),Object.defineProperty(this,"entity",{get:function(){return this._entity}})},t.Component.prototype.listenTo=function(t,e,i){e=e.toLowerCase();var n={self:this,eventName:e,func:i,entity:t},o=t._events[e]||[];return t._events[e]=o,o.push(n),this._listeners.push(n),this},t.Component.prototype.stopListeningTo=function(t,e){e=e.toLowerCase();var i=t._events[e];if(!i)return console.warn("A component tried to stop listening to an event it was not listening to"),this;for(var n=0;n<this._listeners.length;++n){var o=this._listeners[n];if(o.eventName===e&&o.entity===t){this._listeners.splice(n,1);break}}for(n=0;n<i.length;++n){var s=i[n];if(s.self===this){i.splice(n,1);break}}},t.Component.prototype.initialize=function(){if(this._entity&&this._entity._parent){this._entity._parent._childComponents[this._name]||(this._entity._parent._childComponents[this._name]={});var t=this._entity._parent._childComponents[this._name];t[this._entity._id]=this._entity}this._initialize(),this._initialized=!0},t.Component.prototype.serialize=function(t){this._serialize(t)},t.Component.prototype.uninitialize=function(){if(this._entity&&this._entity._parent){var t=this._entity._parent._childComponents[this._name];delete t[this._entity._id]}for(var e=0;e<this._listeners.length;++e){var i=this._listeners[e],n=i.entity._events[i.eventName];if(n)for(var o=0;o<n.length;++o){var s=n[o];s.self===this&&(n.splice(o,1),o=n.length)}}this._listeners=[],this._uninitialize(),this._initialized=!1}}("undefined"==typeof exports?this.TANK=this.TANK||{}:exports),function(t){"use strict";t.ComponentDef=function(e){(e[0]>=0&&e[0]<=9||e.search(" ")>=0)&&t.error(e+" is an invalid identifier and won't be accessible without [] operator"),this._name=e,this._includes=[],this._construct=function(){},this._serialize=function(){},this._initialize=function(){},this._uninitialize=function(){}},t.ComponentDef.prototype.includes=function(t){return Array.isArray(t)||(t=[t]),this._includes=t.slice(),this},t.ComponentDef.prototype.construct=function(t){return this._construct=t,this},t.ComponentDef.prototype.serialize=function(t){return this._serialize=t,this},t.ComponentDef.prototype.initialize=function(t){return this._initialize=t,this},t.ComponentDef.prototype.uninitialize=function(t){return this._uninitialize=t,this}}("undefined"==typeof exports?this.TANK=this.TANK||{}:exports),function(t){"use strict";function e(){var i=new Date,s=(i-n)/1e3;n=i,s>.05&&(s=.05),t.main.update(s),o&&("undefined"==typeof window?setTimeout(e,16):window.requestAnimationFrame(e))}t.createEngine=function(e){return t.main=t.createEntity(e),t},t.start=function(){return t.main.initialize(),t.main.dispatch("start"),o=!0,e(),t},t.stop=function(){o=!1},t.registerComponent=function(e){var i=new t.ComponentDef(e);return t._registeredComponents[e]=i,i},t.createEntity=function(e){var n=new t.Entity(e);return n._id=i++,n};var i=0,n=0,o=!1;t._registeredComponents={}}("undefined"==typeof exports?this.TANK=this.TANK||{}:exports),function(t){"use strict";t.Entity=function(e){this._name=null,this._id=-1,this._parent=null,this._components={},this._componentsOrdered=[],this._children={},this._namedChildren={},this._childComponents={},this._pendingRemove=[],this._initialized=!1,this._events={},this._pendingEvents=[],this._paused=!1,this._deleted=!1,this._actions=new t.Action.Group,t.Action.mixin(this._actions),Object.defineProperty(this,"name",{get:function(){return this._name}}),Object.defineProperty(this,"id",{get:function(){return this._id}}),Object.defineProperty(this,"parent",{get:function(){return this._parent}}),Object.defineProperty(this,"actions",{get:function(){return this._actions}}),e&&this.addComponent(e)},t.Entity.prototype.addComponent=function(e){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;++i){var n=e[i];if(!this._components[n]){var o=t._registeredComponents[n];if(o){this._components[n]="Placeholder",this[n]="Placeholder";for(var s=0;s<o._includes.length;++s)this.addComponent(o._includes[s]);var r=new t.Component(o);if(this._components[n]=r,this[n]=r,this._componentsOrdered.push(r),r._entity=this,this._initialized){if(this._parent){this._parent._childComponents[n]||(this._parent._childComponents[n]={});var a=this._parent._childComponents[n];a[this._id]=r}r.initialize();var h=this._parent||this;h.dispatch(t.Event.componentAdded,r)}}else console.error("No Component is registered with name: "+n+". Did you include it?")}}return this},t.Entity.prototype.removeComponent=function(e){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;++i){var n=e[i],o=this._components[n];if(o){var s=this._parent||this;s.dispatch(t.Event.componentRemoved,o),o.uninitialize(),delete this[n],delete this._components[n];for(var r=0;r<this._componentsOrdered.length;++r)if(this._componentsOrdered[r]===o){this._componentsOrdered.splice(r,1);break}}}return this},t.Entity.prototype.initialize=function(){var e;for(e=0;e<this._componentsOrdered.length;++e){var i=this._componentsOrdered[e];i.initialize();var n=this._parent||this;n.dispatch(t.Event.componentAdded,i)}for(e in this._children)this._children[e].initialize();return this._initialized=!0,this},t.Entity.prototype.uninitialize=function(){var e;for(e=this._componentsOrdered.length-1;e>=0;--e){var i=this._componentsOrdered[e],n=this._parent||this;n.dispatch(t.Event.componentRemoved,i),i.uninitialize()}for(e in this._children)this._children[e].uninitialize();return this._initialized=!1,this},t.Entity.prototype.save=function(){var e={};e.name=this._name,e.components={};for(var i=0;i<this._componentsOrdered.length;++i){var n=this._componentsOrdered[i],o=new t.WriteSerializer;n.serialize(o),e.components[n._name]=o._writeObj}e.children=[];for(var i in this._children){var s=this._children[i];e.children.push(s.save())}return e},t.Entity.prototype.load=function(e){e=JSON.parse(JSON.stringify(e)),e.components=e.components||{},e.children=e.children||{},this._name=e.name;for(var i in e.components){this.addComponent(i);var n=this._components[i],o=new t.ReadSerializer(e.components[i]);"function"==typeof n.serialize&&n.serialize(o)}for(var i=0;i<e.children.length;++i){var s=e.children[i],r=t.createEntity();r.load(s),this.addChild(r)}},t.Entity.prototype.pause=function(){this._paused=!0},t.Entity.prototype.unpause=function(){this._paused=!1},t.Entity.prototype.update=function(e){if(!this._paused){var i;for(i=0;i<this._pendingRemove.length;++i){var n=this._pendingRemove[i]._id,o=this._children[n];this.dispatch(t.Event.childRemoved,o),o.uninitialize(),o._parent=null,delete this._children[n],delete this._namedChildren[o._name]}for(this._pendingRemove=[],i=0;i<this._pendingEvents.length;++i){var s=this._pendingEvents[i];s.time<=0?(this.dispatch.apply(this,s.args),this._pendingEvents.splice(i,1),--i):s.time-=e}for(this._actions.update(this,e),i=0;i<this._componentsOrdered.length;++i)this._componentsOrdered[i].update&&this._componentsOrdered[i].update(e);for(i in this._children)this._children[i].update(e);return this}},t.Entity.prototype.getChildrenWithComponent=function(t){return this._childComponents[t]},t.Entity.prototype.getFirstParentWithComponent=function(t){for(var e=this;e&&!e[t];)e=e._parent;return e},t.Entity.prototype.getChild=function(t){return t.substr?this._namedChildren[t]:isNaN(t)?void 0:this._children[t]},t.Entity.prototype.addChild=function(e,i){return e._parent===this?(console.error("An Entity cannot have duplicate children"),this):!this._initialized&&e._initialized?(console.error("An initialized Entity cannot have an uninitialized parent"),this):e._parent?(console.error("An Entity cannot be given multiple parents"),this):(i&&(e._name=i),this._children[e._id]=e,e._name&&(this._namedChildren[e._name]=e),e._parent=this,e._deleted=!1,this._initialized&&e.initialize(),this.dispatch(t.Event.childAdded,e),this)},t.Entity.prototype.removeChild=function(t){return this._children[t._id]?(t._deleted&&console.error("An Entity was deleted twice"),this._pendingRemove.push(t),t._deleted=!0,this):(console.error("The Entity being removed is not a child of the calling Entity"),this)},t.Entity.prototype.removeAllChildren=function(){for(var t in this._children)this.removeChild(this._children[t])},t.Entity.prototype.removeSelf=function(){this._parent.removeChild(this)},t.Entity.prototype.dispatch=function(t){t=t.toLowerCase();var e=Array.prototype.slice.call(arguments,1,arguments.length),i=this._events[t];if(!i)return this;for(var n=0;n<i.length;++n){var o=i[n];o.func.apply(o.self,e)}},t.Entity.prototype.dispatchNextFrame=function(t){var e=Array.prototype.slice.call(arguments),i={eventName:t,args:e,time:0};this._pendingEvents.push(i)},t.Entity.prototype.dispatchTimed=function(t,e){var i=Array.prototype.slice.call(arguments,1,arguments.length),n={eventName:e,args:i,time:t};this._pendingEvents.push(n)}}("undefined"==typeof exports?this.TANK=this.TANK||{}:exports),function(t){"use strict";t.Event=t.Event||{},t.Event.start="start",t.Event.childAdded="childadded",t.Event.childRemoved="childremoved",t.Event.componentAdded="componentadded",t.Event.componentRemoved="componentremoved"}("undefined"==typeof exports?this.TANK=this.TANK||{}:exports),function(t){"use strict";t.Key={},t.Key.LEFT_MOUSE=0,t.Key.MIDDLE_MOUSE=1,t.Key.RIGHT_MOUSE=2,t.Key.LEFT_ARROW=37,t.Key.UP_ARROW=38,t.Key.RIGHT_ARROW=39,t.Key.DOWN_ARROW=40,t.Key.SHIFT=16,t.Key.BACKSPACE=8,t.Key.ESCAPE=27,t.Key.SPACE=32,t.Key.CONTROL=17,t.Key.ALT=18,t.Key.SUPER=91,t.Key.TILDE=192,t.Key.A=65,t.Key.B=66,t.Key.C=67,t.Key.D=68,t.Key.E=69,t.Key.F=70,t.Key.G=71,t.Key.H=72,t.Key.I=73,t.Key.J=74,t.Key.K=75,t.Key.L=76,t.Key.M=77,t.Key.N=78,t.Key.O=79,t.Key.P=80,t.Key.Q=81,t.Key.R=82,t.Key.S=83,t.Key.T=84,t.Key.U=85,t.Key.V=86,t.Key.W=87,t.Key.X=88,t.Key.Y=89,t.Key.Z=90,t.Key.NUM0=48,t.Key.NUM1=49,t.Key.NUM2=50,t.Key.NUM3=51,t.Key.NUM4=52,t.Key.NUM5=53,t.Key.NUM6=54,t.Key.NUM7=55,t.Key.NUM8=56,t.Key.NUM9=57}("undefined"==typeof exports?this.TANK=this.TANK||{}:exports),function(t){"use strict";t.Math2D=t.Math2D||{},t.Math2D.length=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},t.Math2D.lengthSquared=function(t){return t[0]*t[0]+t[1]*t[1]},t.Math2D.normalize=function(e){return t.Math2D.scale(e,1/t.Math2D.length(e))},t.Math2D.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},t.Math2D.cross=function(t,e){return t[0]*e[1]-t[1]*e[0]},t.Math2D.add=function(t,e){return[t[0]+e[0],t[1]+e[1]]},t.Math2D.subtract=function(t,e){return[t[0]-e[0],t[1]-e[1]]},t.Math2D.scale=function(t,e){return[t[0]*e,t[1]*e]},t.Math2D.rotate=function(t,e){return[t[0]*Math.cos(e)-t[1]*Math.sin(e),t[1]*Math.cos(e)+t[0]*Math.sin(e)]},t.Math2D.project=function(e,i){return t.Math2D.scale(i,t.Math2D.dot(i,e)/t.Math2D.lengthSquared(i))},t.Math2D.projectOntoLine=function(e,i,n){var o=t.Math2D.normalize(n);return t.Math2D.add(i,t.Math2D.scale(o,t.Math2D.dot(t.Math2D.subtract(e,i),o)))},t.Math2D.pointDistancePoint=function(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))},t.Math2D.pointDistanceLine=function(e,i,n,o){var s=t.Math2D.subtract(n,i),r=t.Math2D.lengthSquared(s);if(0===r)return t.Math2D.pointDistancePoint(i,e);var a=t.Math2D.dot(t.Math2D.subtract(e,i),s)/r;if(o){if(0>a)return t.Math2D.pointDistancePoint(e,i);if(a>1)return t.Math2D.pointDistancePoint(e,n)}var h=t.Math2D.projectOntoLine(e,i,s);return t.Math2D.pointDistancePoint(e,h)},t.Math2D.pointInAABB=function(t,e,i){var n=[i[0]/2,i[1]/2];return t[0]<e[0]-n[0]||t[1]<e[1]-n[1]?!1:t[0]>e[0]+n[0]||t[1]>e[1]+n[1]?!1:!0},t.Math2D.pointInOBB=function(e,i,n,o){var s=[];return s[0]=(e[0]-i[0])*Math.cos(-o)-(e[1]-i[1])*Math.sin(-o)+i[0],s[1]=(e[0]-i[0])*Math.sin(-o)+(e[1]-i[1])*Math.cos(-o)+i[1],t.Math2D.pointInAABB(s,i,n)},t.Math2D.AABBInAABB=function(t,e,i,n){return t[0]+e[0]/2<i[0]-n[0]/2?!1:t[1]+e[1]/2<i[1]-n[1]/2?!1:t[0]-e[0]/2>i[0]+n[0]/2?!1:t[1]-e[1]/2>i[1]+n[1]/2?!1:!0},t.Math2D.lineIntersection=function(e,i,n,o){var s=[i[0]-e[0],i[1]-e[1]],r=t.Math2D.pointDistancePoint(e,i);s[0]/=r,s[1]/=r;var a=[o[0]-n[0],o[1]-n[1]],h=t.Math2D.pointDistancePoint(n,o);a[0]/=h,a[1]/=h;var c=[n[0]-e[0],n[1]-e[1]],p=(c[0]*a[1]-c[1]*a[0])/(s[0]*a[1]-s[1]*a[0]),d=(c[0]*s[1]-c[1]*s[0])/(s[0]*a[1]-s[1]*a[0]);return p>=0&&r>=p&&d>=0&&h>=d?[e[0]+s[0]*p,e[1]+s[1]*p]:null},t.Math2D.getDirectionToPoint=function(t,e,i){var n=[Math.cos(e),Math.sin(e)],o=Math.atan2(i[1]-t[1],i[0]-t[0]),s=[Math.cos(o),Math.sin(o)];return n[0]*s[1]-n[1]*s[0]}}("undefined"==typeof exports?this.TANK=this.TANK||{}:exports),function(t){t.WriteSerializer=function(){this.mode="write",this._writeObj={}},t.WriteSerializer.prototype.property=function(t,e){this._writeObj[e]=t[e]},t.ReadSerializer=function(t){this.mode="read",this._readObj=t},t.ReadSerializer.prototype.property=function(t,e,i){var n=this._readObj[e];t[e]="undefined"!=typeof n?n:i}}("undefined"==typeof exports?this.TANK=this.TANK||{}:exports);